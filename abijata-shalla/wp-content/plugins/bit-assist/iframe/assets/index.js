!function(){"use strict";const t=t=>document.querySelector(t),i=(t,i)=>{const e=document.createElement(t);if(i)for(const t in i)e.setAttribute(t,i[t]);return e},e=(t,i)=>Array.isArray(i)?t.append(...i):t.append(i),s=(t,i,e)=>t.addEventListener(i,e),a=(t,i,e)=>t.setProperty(i,e),n=(t,i,e)=>t.postMessage(i,e),o=(t,i)=>t?.classList.remove(i),l=(t,i)=>t?.classList.add(i),d=(t,i)=>t?.classList.contains(i),h=(t,i)=>t?.classList.toggle(i);class c{apiEndPoint;root;widgetData;clientDomain;widgetBubble;widgetBubbleWrapper;contentWrapper;widgetWrapper;channels;#t;#i;#e;callToAction;closeCallToAction;#s;card;selectedFormBg;cardBody;formBody;#a;iFrameWrapper;animationName;formData;clickTrack;constructor(i){this.clickTrack={isWidgetClicked:!1},this.#a=!0,this.#s=!0,this.#t=!1,this.root=document.documentElement,this.clientDomain=i.clientDomain,this.contentWrapper=t("#contentWrapper"),this.widgetWrapper=t("#widgetWrapper"),this.widgetBubbleWrapper=t("#widgetBubbleWrapper"),this.widgetBubble=t("#widgetBubble"),this.addEvents(),this.getClientInfo()}delay=t=>new Promise((i=>setTimeout(i,1e3*t)));addEvents=()=>{s(window,"message",this.onMessageReceived),s(this.widgetBubble,"click",this.onBubbleClick)};closeWidget=()=>{this.hideCard(),this.hideChannels(),void 0!==this.iFrameWrapper&&this.removeIframe(),o(this.widgetBubble,"open"),l(this.contentWrapper,"hide"),this.widgetOpenActions(!1),a(this.root.style,"--card-width","330px"),this.showActiveBadge(),this.enableAnimation()};widgetClickRequest=async()=>{if(d(this.channels,"show")&&!this.clickTrack.isWidgetClicked){this.clickTrack.isWidgetClicked=!0;try{await fetch(`${this.apiEndPoint}/analyticsStore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_id:this.widgetData.id,is_clicked:1})}).then((t=>t.json()))}catch(t){console.log(t)}}};onBubbleClick=(t,i=!1)=>{if(!i||!d(this.widgetBubble,"open")){if("widget_box"===this.widgetData?.styles?.widget_style&&l(this.contentWrapper,"widget-box"),h(this.channels,"show"),1===this.widgetData?.isAnalyticsActivate&&this.widgetClickRequest(),d(this.card,"show"))a(this.root.style,"--card-width","330px"),this.hideCard(),this.resetClientWidgetSize();else if(void 0!==this.iFrameWrapper)this.removeIframe();else{h(this.contentWrapper,"hide");const t=h(this.widgetBubble,"open");this.widgetOpenActions(t)}d(this.contentWrapper,"hide")?(this.showActiveBadge(),this.enableAnimation()):(this.hideActiveBadge(),this.disableAnimation())}};widgetOpenActions=t=>{this.openClientWidget(t),!t||d(this.callToAction,"hide")?this.resetClientWidgetSize():this.callToActionHide()};callToActionHide=()=>{l(this.callToAction,"hide"),l(this.closeCallToAction,"hide"),this.resetClientWidgetSize()};channelClickRequest=async t=>{if(void 0!==t&&!this.clickTrack.hasOwnProperty(t)){this.clickTrack[t]=!0;try{await fetch(`${this.apiEndPoint}/analyticsStore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_id:this.widgetData.id,channel_id:t,is_clicked:1})}).then((t=>t.json()))}catch(t){console.log(t)}}};onChannelClick=t=>{t.preventDefault();let i=t.target.closest(".channel");"widget_box"===this.widgetData?.styles?.widget_style&&(i=t.target.closest(".channel-widget-box"));const{id:e,url:s,channel_name:a,target:n}=i.dataset||{},o=this.widgetData?.widget_channels.find((t=>t.id===e)),{title:l,unique_id:d}=o?.config||{},{isChatWidget:h}=o?.config?.card_config||{};1===this.widgetData?.isAnalyticsActivate&&this.channelClickRequest(e),"faq"===a?this.renderFaq(o):"custom-form"===a?this.renderForm(o):"woocommerce"===a?this.renderWooCommerce(o):"knowledge-base"===a?this.renderKnowledgeBase(o):"wp-search"===a?this.renderWPSearch(o?.config):"google-map"===a?this.renderIframe(s,a,d):"youtube"===a||"custom-iframe"===a?this.renderIframe(s,a,!1,o?.config?.iframe_options):h?this.chatWidgetClick(a):"new_window"===n&&"#"!==s?window.open(s,"_blank","popup"):"#"!==s&&window.open(s,n),this.resetClientWidgetSize(),1===this.widgetData?.styles?.google_analytics&&this.channelClickEventTrigger(a,l,s)};getClientInfo=()=>{n(parent,{action:"getClientInfo"},`${this.clientDomain}`)};openClientWidget=t=>{n(parent,{action:"widgetOpen",isWidgetOpen:t},`${this.clientDomain}`)};removeClientWidget=()=>{n(parent,{action:"removeWidget"},`${this.clientDomain}`)};renderWidgetConf=()=>{n(parent,{action:"widgetLoaded",height:(this.widgetData?.styles?.size||60)+20,width:(this.widgetData?.styles?.size||60)+20,position:this.widgetData?.styles?.position,top:this.widgetData?.styles?.top||0,bottom:this.widgetData?.styles?.bottom||0,left:this.widgetData?.styles?.left||0,right:this.widgetData?.styles?.right||0,pageScroll:this.widgetData?.page_scroll},`${this.clientDomain}`)};chatWidgetClick=t=>{n(parent,{action:"chatWidgetClick",chatWidgetName:t},`${this.clientDomain}`)};channelClickEventTrigger=(t,i,e)=>{n(parent,{action:"bitAssistChannelClick",channelInfo:{channelType:t,channelName:i,channelUrl:e}},`${this.clientDomain}`)};onMessageReceived=t=>{const{action:i}=t.data;"windowLoaded"===i?this.handleWindowLoaded(t.data):"scrollPercent"===i?this.handleScrollPercent(t.data):"clickOutside"===i&&this.closeWidget()};handleWindowLoaded=({url:t,winWidth:i,winHeight:e,scrollPercent:s,apiEndPoint:n})=>{a(this.root.style,"--client-win-width",i+"px"),a(this.root.style,"--client-win-height",e+"px"),this.#e=s,this.apiEndPoint=n,this.#t=i<768,this.#i=t.slice(this.clientDomain.length+1,t.length),this.fetchWidgetData()};handleScrollPercent=({scrollPercent:t})=>{this.#e=t,this.widgetData?.page_scroll>0&&!this.#a&&this.widgetShowAfterScroll()};fetchWidgetData=async()=>{try{const{data:t}=await fetch(`${this.apiEndPoint}/bitAssistWidget`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:this.clientDomain})}).then((t=>t.json()));if(this.widgetData=t,void 0===this.widgetData.id)return console.error(this.widgetData),void this.removeClientWidget();const i=await import(this.widgetData.featuresJsPath);void 0!==i&&Object.values(i).forEach((t=>Object.assign(c.prototype,t))),this.widgetSetup()}catch(t){console.log(t),this.removeClientWidget()}};widgetSetup=async()=>{const t=this.widgetData?.styles?.widget_show_on;if(void 0!==t){if(0===t.length)return;if(this.#t&&!t.includes("mobile"))return;if(!this.#t&&!t.includes("desktop"))return}this.setWidgetVisibleOrNot()&&(this.renderWidgetConf(),this.widgetData?.business_hours?.length&&!this.checkBusinessHours()||(this.addCustomStyles(),this.renderChannels(),this.renderWidgetBubble(),this.hideCredit(),this.#a=!0,await this.widgetShowDelay(),this.delayExist=!1,this.showCallToAction(),this.widgetShowAfterScroll(),this.widgetData.styles?.position?.indexOf("top")>-1&&a(this.root.style,"--widget-minus-sizeY",(this.widgetData.styles?.top||0)+"px"),this.widgetData.styles?.position?.indexOf("bottom")>-1&&a(this.root.style,"--widget-minus-sizeY",(this.widgetData.styles?.bottom||0)+"px"),this.widgetData.styles?.position?.indexOf("left")>-1&&a(this.root.style,"--widget-minus-sizeX",(this.widgetData.styles?.left||0)+"px"),this.widgetData.styles?.position?.indexOf("right")>-1&&a(this.root.style,"--widget-minus-sizeX",(this.widgetData.styles?.right||0)+"px"),this.widgetData?.isAnalyticsActivate&&"undefined"!==this.widgetData.id&&0!==this.widgetData.widget_channels.length&&await fetch(`${this.apiEndPoint}/analyticsStore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({widget_id:this.widgetData.id})}).then((t=>t.json()))))};hideCredit=()=>{this.widgetData?.hide_credit&&t("#credit")?.remove()};setWidgetVisibleOrNot=()=>{if(this.widgetData?.exclude_pages?.length>0){let t=!1,i=!1;const e=this.widgetData?.exclude_pages.some((e=>("showOn"===e.visibility&&(t=!0),!!("contains"===e.condition&&this.#i.includes(e.url)||"equal"===e.condition&&this.#i===e.url||"startWith"===e.condition&&this.#i.startsWith(e.url)||"endWith"===e.condition&&this.#i.endsWith(e.url))&&("hideOn"===e.visibility||(i=!0,!1)))));if(t&&!e&&!i||!t&&e&&!i)return this.removeClientWidget(),!1}return!0};checkBusinessHours=()=>{const t=new Date,i=this.widgetData?.business_hours[t.getDay()];if(!i||!i?.start||!i?.end)return this.removeClientWidget(),!1;const[e,s]=i?.start.split(":").map(Number)||[0,0],[a,n]=i?.end.split(":").map(Number)||[0,0],o=this.widgetData?.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,l=t.toLocaleTimeString("en-US",{timeZone:o,hour12:!1}),[d,h]=l.split(":").map(Number);return(d<e||d===e&&h<s||d>a||d===a&&h>n)&&(this.#s=!1),!0};addCustomStyles=()=>{if(this.widgetData.custom_css?.length>0){const t=i("style");e(t,document.createTextNode(this.widgetData.custom_css)),e(document.head,t)}};renderChannels=()=>{const t=this.widgetData?.styles?.widget_style;this.channels=i("div",{id:"channels"}),"widget_box"===t&&l(this.channels,"channel-padding");const a=this.widgetData?.widget_channels?.filter((t=>(this.#t&&t.config?.channel_show_on.includes("mobile")||!this.#t&&t.config?.channel_show_on.includes("desktop"))&&(!this.#s&&!t.config?.hide_after_office_hours||this.#s))).map((s=>{const a=i("button",{class:"widget_box"===t?"channel-widget-box":"channel","data-id":s.id,"data-channel_name":s.channel_name.toLowerCase(),"data-url":s.config?.url||"#","data-target":s.config.open_window_action}),n=i("div",{class:"channel-name"});var o,l;o=n,l=s.config.title,o.innerText=l;const d=i("div",{class:"channel-icon"}),h=i("img",{src:s.channel_icon,alt:s.config.title});return e(d,h),e(a,[n,d]),a}));var n,o;e(this.channels,a),e(this.contentWrapper,this.channels),"widget_box"===t&&l(this.contentWrapper,"widget-box"),(n=document,o="widget_box"===t?".channel-widget-box":".channel",n.querySelectorAll(o)).forEach((t=>{s(t,"click",this.onChannelClick)}))};renderWidgetBubble=()=>{a(this.root.style,"--widget-size",(this.widgetData?.styles?.size||60)+"px"),a(this.root.style,"--widget-color",this.widgetData?.styles?.color?.str),2===this.widgetData?.widget_behavior?s(this.widgetBubble,"mouseenter",(t=>this.onBubbleClick(t,!0))):3===this.widgetData?.widget_behavior&&this.onBubbleClick(),l(this.widgetBubble,this.widgetData?.styles?.shape),l(this.widgetWrapper,this.widgetData?.styles?.position),t("#widget-img").src=this.widgetData?.styles?.customImage||this.widgetData?.styles?.iconUrl,l(t("#widget-img"),this.widgetData?.styles?.customImage?"image":"icon");const i=Math.round((299*parseInt(this.widgetData?.styles?.color?.r,10)+587*parseInt(this.widgetData?.styles?.color?.g,10)+114*parseInt(this.widgetData?.styles?.color?.b,10))/1e3);a(this.root.style,"--widget-bubble-icon-color",i>125?"invert(0)":"invert(1)"),this.showActiveBadge(),this.enableAnimation(),d(this.channels,"show")&&(this.hideActiveBadge(),this.disableAnimation())};showActiveBadge=()=>{const t=this.widgetData?.styles?.shape;0===this.widgetData?.styles?.badge_active?o(this.widgetBubbleWrapper,`active-${t}`):(l(this.widgetBubbleWrapper,`active-${t}`),a(this.root.style,"--widget-active-badge-color",this.widgetData?.styles?.badge_color?.str)),this.resetClientWidgetSize()};hideActiveBadge=()=>{o(this.widgetBubbleWrapper,`active-${this.widgetData?.styles?.shape}`)};enableAnimation=()=>{const t=this.widgetData?.styles?.animation_type;1===this.widgetData?.styles?.animation_active&&(a(this.root.style,"--animation-delay",this.widgetData?.styles?.animation_delay?.delay+"s"),1===t?(this.animationName="--wiggle-animation",l(this.widgetBubbleWrapper,this.animationName)):2===t?(this.animationName="--jump-animation",l(this.widgetBubbleWrapper,this.animationName)):3===t&&(this.animationName="--shockwave-animation",l(this.widgetBubbleWrapper,this.animationName))),this.resetClientWidgetSize()};disableAnimation=()=>{o(this.widgetBubbleWrapper,this.animationName)};widgetShowDelay=async()=>{this.widgetData?.initial_delay>0&&await this.delay(this.widgetData.initial_delay)};widgetShowAfterScroll=async()=>{this.widgetData?.page_scroll<=0||this.#e>=this.widgetData?.page_scroll?o(this.widgetWrapper,"hide"):l(this.widgetWrapper,"hide"),this.resetClientWidgetSize()};showCallToAction=async()=>{if(!this.widgetData?.call_to_action?.text)return;var a,n;this.widgetData?.call_to_action?.delay>0&&await this.delay(this.widgetData.call_to_action.delay),this.callToAction=i("div",{id:"callToActionMsg"}),a=this.callToAction,n=this.widgetData.call_to_action.text,a.innerHTML=n;const o=i("img",{src:"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 10' fill='black'%3e%3cpath d='M6.061 5l2.969-2.969A.75.75 0 0 0 9.03.97.75.75 0 0 0 7.969.969L5 3.938 2.031.969a.75.75 0 0 0-1.062 0 .75.75 0 0 0 0 1.063L3.938 5 .969 7.969a.75.75 0 0 0 0 1.062.75.75 0 0 0 1.063 0L5 6.063l2.969 2.969a.75.75 0 0 0 1.063 0 .75.75 0 0 0 0-1.062L6.061 5z'/%3e%3c/svg%3e"});this.closeCallToAction=i("button",{class:"iconBtn",id:"closeCallToAction"}),e(this.closeCallToAction,o),s(this.closeCallToAction,"click",this.callToActionHide),t("#widgetBubbleRow").prepend(this.closeCallToAction,this.callToAction),d(this.widgetBubble,"open")?this.callToActionHide():this.resetClientWidgetSize()}}const r=new URL(window.location.href).searchParams.get("clientDomain").split("-protocol-bit-assist-"),g=("i"===r[0]?"http://":"https://")+r[1];window.addEventListener("load",(function(){new c({clientDomain:g})}))}();
